<div layout="row" style="height: 400px; width: 900px;">
  <div id="diagramm-data-only-showcase" style="height: 400px; width: 750px;"></div>
  <div style="margin-top: 100px; margin-left: 10px;">
    <div layout="row" layout-wrap>
      <div flex="100" flex-gt-sm="50" layout="column">
        <div>
          <fieldset class="standard" >
            <legend>Selector</legend>
            <div layout="row" layout-wrap flex>
              <div flex="100" ng-repeat="item in items">
                <md-checkbox ng-checked="exists(item, selected)" ng-click="toggle(item, selected)">
                  Type {{ item }} <span ng-if="exists(item, selected)">selected</span>
                </md-checkbox>
              </div>
            </div>
          </fieldset>
        </div>
      </div>
    </div>
  </div>
</div>

<div layout="row" style="height: 400px; width: 900px;">
  <div id="diagramm-data-only" style="height: 400px; width: 750px;"></div>
  <div style="margin-top: 100px; margin-left: 10px;">
    <div layout="row" layout-wrap>
      <div flex="100" flex-gt-sm="50" layout="column">
        <div>
          <fieldset class="standard" >
            <legend>Selector</legend>
            <div layout="row" layout-wrap flex>
              <div flex="100" ng-repeat="item in items">
                <md-checkbox ng-checked="exists(item, selected)" ng-click="toggle(item, selected)">
                  Type {{ item }} <span ng-if="exists(item, selected)">selected</span>
                </md-checkbox>
              </div>
            </div>
          </fieldset>
        </div>
      </div>
    </div>
    <md-datepicker ng-model="startDate" md-placeholder="Enter start date"></md-datepicker>
    <md-datepicker ng-model="endDate" md-placeholder="Enter end date"></md-datepicker>
  </div>
</div>

<section layout="row" layout-sm="column" layout-wrap style="width: 900px;">
  <!--<md-button ng-disabled="true" ng-click="removePoints(type)" ng-repeat="seriesSet in series" class="md-raised md-primary">{{ type }} DAY</md-button>-->
  <!--<md-button ng-disabled="disabledDay(key)" ng-click="toggleDay(key)" ng-repeat="(key, seriesSet) in series.days" class="md-raised md-primary">{{ $index+1 }} DAY</md-button>-->
  <md-button ng-click="toggleDay(key)" ng-repeat="(key, seriesSet) in series.days" class="md-primary" ng-class="raised(key)">{{ $index+1 }}</md-button>
  <md-button ng-click="showAllDays()" class="md-primary" ng-class="raised(key)">ALL</md-button>
</section>

<div style="height: 400px;">
  <div id="sleep" style="height: 400px; width: 600px;"></div>
  <div id="heatmap" style="position: relative; top: -400px; z-index: 2;">
    <canvas width="600" height="400"></canvas>
  </div>
</div>

<style>
  #punchcard .tick {
    fill: black;
  };

  #punchcard .axis path,
  #punchcard .axis line {
      fill: none;
      stroke: #eee;
      shape-rendering: crispEdges;
  }

  #punchcard .axis text {
      font-family: sans-serif;
      font-size: 11px;
  }

  #punchcard .loading {
      font-family: sans-serif;
      font-size: 15px;
  }

  #punchcard .circle {
      fill: #222;
  }
</style>

<div class="punchcard" style="max-width: 600px; margin-top: 40px;">
  <!--<div id="bench" style="margin-top: 10px;"></div>-->
  <div id="punchcard"></div>
</div>

<script>
  (function(d3){
      var w = 940,
          h = 300,
          pad = 20,
          left_pad = 100;

      var svg = d3.select("#punchcard")
        .append("svg")
        .attr("width", w)
        .attr("height", h);

      var x = d3.scale.linear().domain([0, 23]).range([left_pad, w-pad]),
          y = d3.scale.linear().domain([0, 6]).range([pad, h-pad*2]);

      var xAxis = d3.svg.axis().scale(x).orient("bottom")
        .ticks(24)
        .tickFormat(function (d, i) {
            var m = (d > 12) ? "p" : "a";
            return (d%12 == 0) ? 12+m :  d%12+m;
        }),
      yAxis = d3.svg.axis().scale(y).orient("left")
        .ticks(7)
        .tickFormat(function (d, i) {
            return ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'][d];
        });

      svg.append("g")
          .attr("class", "axis")
          .attr("transform", "translate(0, "+(h-pad)+")")
          .call(xAxis);

      svg.append("g")
          .attr("class", "axis")
          .attr("transform", "translate("+(left_pad-pad)+", 0)")
          .call(yAxis);

      svg.append("text")
          .attr("class", "loading")
          .text("Loading ...")
          .attr("x", function () { return w/2; })
          .attr("y", function () { return h/2-5; });

      function draw(punchcard_data) {
        var max_r = d3.max(punchcard_data.map(function (d) { return d[2]; })),
        r = d3.scale.linear()
            .domain([0, d3.max(punchcard_data, function (d) { return d[2]; })])
            .range([0, 12]);

        svg.selectAll(".loading").remove();

        svg.selectAll("circle")
          .data(punchcard_data)
          .enter()
          .append("circle")
          .attr("class", "circle")
          .attr("cx", function (d) { return x(d[1]); })
          .attr("cy", function (d) { return y(d[0]); })
          .transition()
          .duration(800)
          .attr("r", function (d) { return r(d[2]); });
      };

      //'Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'
      //var data = [[0, 20, 10], [6, 0, 3]];
      var data = [];
      for(var i=0; i<24; i+=1){
        for(var j=0; j<6; j+=1){
          if(Math.random() >= 0.5){
            data.push([j, i, Math.floor(Math.random()*40)]);
          }
        }
      }
      draw(data);
  }(d3));
</script>

<div style="background-color: #092946;">
  <div id="toolTip" style="color:white"></div>
  <svg id="gaussianContainerCruve" width="1000" height="500"></svg>
</div>

<script>
(function(){
  var toolTipElement = document.getElementById("toolTip");
    toolTipElement.style.position ="absolute";

    function showToolTip(value,positionX,positionY){

        toolTipElement.style.top =positionY + 10 + "px";
        toolTipElement.style.left =positionX + 10 +"px";
        toolTipElement.innerHTML = " Z = " + value;

    }
    function hideToolTip(){
        toolTipElement.innerHTML = " ";

    }

    function drawGaussianCurve() {

        var calculationService = (function (){
            var distanceFromMean = 5;

            function getRightBound(middle,step){
                return middle + step *5;
            }
            function getLeftBound(middle,step){
                return middle - (step*distanceFromMean)
            }
            function sort(values){
                return values.sort(function (a,b){return a-b;});
            }
            function getVariance (values,mean){
                var temp = 0;
                var numberOfValues = values.length;
                while( numberOfValues--){
                    temp += Math.pow( (values[numberOfValues ] - mean), 2 );
                }
                return temp / values.length;
            }

            function getSum(values){
                return values.reduce(function(previousValue, currentValue) {
                    return previousValue + currentValue;
                });
            }

            function getGaussianFunctionPoints(std,mean,variance,leftBound,rightBound){
                var data = [];
                for (var i = leftBound; i <= rightBound;i++) {
                    data.push({x:i,y:(1/(std*Math.sqrt(Math.PI*2)))*Math.exp(-(Math.pow(i-mean,2)/ (2*variance)))});
                }
                //console.log(data);
                return  data;
            }

            function getMean (valueSum,numberOfOccurrences){
                return valueSum / numberOfOccurrences
            }

            function getZ(x,mean,standardDerivation){

                return (x-mean)/standardDerivation;
            }

            function getWeightedValues(values){
                var weightedValues= {};
                var data= [];
                var lengthValues = values.length;
                for (var i = 0; i < lengthValues; i++) {
                    var label = values[i].toString();

                    if(weightedValues[label]){
                        weightedValues[label].weight++;
                    }else{
                        weightedValues[label]={weight :1,value :label};
                        data.push(weightedValues[label]);
                    }
                }

                return data;


            }
            function getRandomNumber(min,max) {
                return (Math.round((max-min) * Math.random() + min));
            }

            function getRandomValueArray (numberOfValues,min,max){
                var values = [];
                for (var i = 0; i < numberOfValues; i++) {
                    values.push(getRandomNumber(min,max));
                }
                return values
            }
            return {
                getRandomValueArray: getRandomValueArray,
                getGaussianFunctionPoints: getGaussianFunctionPoints,
                getWeightedValues: getWeightedValues,
                getSum: getSum,
                getMean: getMean,
                sort: sort,
                getVariance: getVariance,
                getLeftBound: getLeftBound,
                getZ: getZ,
                getRightBound: getRightBound

            };

        })();



        var seriesName = "RANDOM VARIABLE";
        var sample = calculationService.sort(calculationService.getRandomValueArray(200,-100,100));
        var sum = calculationService.getSum(sample);
        var min = sample[0];
        var max = sample[sample.length - 1];
        var mean = calculationService.getMean(sum, sample.length);
        var variance = calculationService.getVariance(sample, mean);
        var standardDerivation =  Math.sqrt(variance);
        var rightBound = calculationService.getRightBound(mean, standardDerivation);
        var leftBound = calculationService.getLeftBound(mean,standardDerivation);
        var bottomBound = 0;
        var topBound = 1/(standardDerivation*Math.sqrt(Math.PI*2));
        var gaussianCurveData = calculationService.getGaussianFunctionPoints(standardDerivation,mean,variance,leftBound,rightBound);


        var gaussianWidget = {
            width: 1000,
            height: 500,
            margins: {
                top: 20,
                right: 20,
                bottom: 20,
                left: 50
            },
            curve :{
                color : "red",
                fill : "aquamarine",
                stroke : 2,
                opacity : 0.25

            },
            circles :{
                radiusCoef : 5,
                fill : "red",
                opacity : 0.5
            }

        };



        /*document.write("<br/>");
        document.write("<br/>");
        document.write("<br/>");
        document.write("<div style='color: white;width:500px;word-wrap: break-word'>");
        document.write("| min | "+ min.toLocaleString() );
        document.write("<br/>");
        document.write("| max | "+ max.toLocaleString() );
        document.write("<br/>");
        document.write("| mean | "+ mean.toLocaleString() );
        document.write("<br/>");
        document.write("| variance | "+ variance.toLocaleString() );
        document.write("<br/>");
        document.write("| standard derivation | "+ standardDerivation.toLocaleString());
        document.write("<br/>");
        document.write("<br/>");
        document.write("| var (x) | "+ sample);
        document.write("</div>");*/





        var vis = d3.select("#gaussianContainerCruve"),
                width = gaussianWidget.width,
                height = gaussianWidget.height,
                margins = {
                    top: gaussianWidget.margins.top,
                    right: gaussianWidget.margins.right,
                    bottom: gaussianWidget.margins.bottom,
                    left: gaussianWidget.margins.left
                },

                xScale = d3.scale.linear().range([margins.left, width-margins.right ]).domain([leftBound, rightBound]),
                yScale = d3.scale.linear().range([height - margins.top, margins.bottom]).domain([bottomBound, topBound]),


                xAxis = d3.svg.axis().ticks(20)
                        .scale(xScale),

                yAxis = d3.svg.axis()
                        .scale(yScale)
                        .ticks(10)
                        .tickPadding(0)
                        .orient("right");



        var lineGen = d3.svg.line()
                .x(function(d) {
                    return xScale(d.x);
                })
                .y(function(d) {
                    return yScale(d.y);
                })

                .interpolate("basis");

        vis.append('svg:path')
                .attr('d', lineGen(gaussianCurveData))
                .data([gaussianCurveData])
                .attr('stroke', gaussianWidget.curve.color)
                .attr('stroke-width', gaussianWidget.curve.stroke)
                .on('mousemove', function(d){
                    showToolTip(calculationService.getZ(xScale.invert(d3.event.x),mean,standardDerivation).toLocaleString(),d3.event.x,d3.event.y);

                })
                .on('mouseout', function(d){
                    hideToolTip();
                })
                .attr('fill', gaussianWidget.curve.fill)
                .style("opacity",gaussianWidget.curve.opacity);


        vis.append("svg:g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + (height - margins.bottom) + ")")
                .call(xAxis);

        vis.append("svg:g")
                .attr("class", "y axis")
                .attr("transform", "translate(" + (xScale(mean)-7) + ",0)")
                .call(yAxis);




        vis.append("svg:g")
                .append("text")      // text label for the x axis
                .attr("x", width/2 + width/4  )
                .attr("y", 20  )

                .style("text-anchor", "middle")
                .style("fill", "white")
                .text(seriesName);

        vis.selectAll("circle")
                .data(calculationService.getWeightedValues(sample)).enter().append("circle")
                // text label for the x axis
                .attr("cx", function (d) { return xScale(d.value)})
                .attr("cy", height - margins.bottom)
                .attr("r", function (d) { return d.weight*gaussianWidget.circles.radiusCoef; })
                .style("fill",gaussianWidget.circles.fill)
                .style("opacity",gaussianWidget.circles.opacity);
    }

    drawGaussianCurve();
}());
</script>
<div id="diagramm-data-only3" style="height: 400px; width: 600px;"></div>
<div id="diagramm-data-only1" style="height: 400px; width: 600px;"></div>
<div id="diagramm-data-only2" style="height: 400px; width: 600px;"></div>
